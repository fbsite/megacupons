<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• (HOJE) Cupons, Lojas e Ofertas REAIS | MegaCupons</title>
    <meta name="description" content="Economize AGORA! Pegue cupons, ofertas de produtos e campanhas 100% gr√°tis para Magazine Luiza, Amazon e mais. Ofertas reais, atualizadas agora.">
    
    <!-- Metatags e Links (Omesmo de antes) -->
    <meta name="keywords" content="cupons de desconto, ofertas, lojas, produtos, campanhas, adsense, promo√ß√£o, economizar, magazine luiza, amazon, americanas, frete gr√°tis, mega cupons">
    <meta property="og:title" content="üî• (HOJE) Cupons, Lojas e Ofertas REAIS | MegaCupons">
    <meta property="og:description" content="Economize AGORA! Ofertas reais que expiram em breve.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.megacupons.com.br">
    <meta property="og:image" content="https://placehold.co/1200x630/FF3B80/FFFFFF?text=MegaCupons&font=inter">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üî•</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "MegaCupons",
      "url": "https://www.megacupons.com.br",
      "description": "Cupons de desconto, ofertas de produtos e campanhas reais e verificadas."
    }
    </script>
    
    <!-- Todo o CSS (O mesmo de antes) -->
    <style>
        :root {
            --color-primary: #FF3B80;
            --color-secondary: #00BFA6;
            --color-warning: #FFA726;
            --color-background: #121212;
            --color-surface: #1E1E1E;
            --color-text-primary: #FFFFFF;
            --color-text-secondary: #B0B0B0;
            --font-main: 'Inter', sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-main);
            background-color: var(--color-background);
            color: var(--color-text-primary);
            line-height: 1.6;
            padding-bottom: 100px; 
        }
        img { max-width: 100%; height: auto; display: block; }
        .container { width: 90%; max-width: 1100px; margin: 0 auto; padding: 20px 0; }
        .section-title { font-size: 2rem; font-weight: 900; text-align: center; margin-bottom: 30px; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 59, 128, 0.7); } 70% { transform: scale(1.03); box-shadow: 0 0 10px 20px rgba(255, 59, 128, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 59, 128, 0); } }
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .hover-lift { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .hover-lift:hover { transform: translateY(-8px); box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3); }
        .header { background-color: var(--color-surface); border-bottom: 2px solid var(--color-primary); padding: 15px 0; }
        .header .container { display: flex; justify-content: center; align-items: center; gap: 10px; }
        .logo { font-size: 1.8rem; font-weight: 900; color: var(--color-primary); text-decoration: none; }
        .logo i { margin-right: 5px; }
        .hero { text-align: center; padding: 40px 0; background: linear-gradient(180deg, var(--color-surface) 0%, var(--color-background) 100%); }
        .hero h1 { font-size: 2.5rem; font-weight: 900; line-height: 1.2; margin-bottom: 15px; color: var(--color-text-primary); }
        .hero h1 i { color: var(--color-warning); }
        .hero-subtitle { font-size: 1.1rem; color: var(--color-text-secondary); margin-bottom: 30px; }
        .countdown-title { font-size: 1rem; font-weight: 700; color: var(--color-warning); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; animation: blink 1.5s infinite; }
        .countdown-timer { display: flex; justify-content: center; gap: 15px; }
        .timer-block { background-color: var(--color-surface); padding: 15px; border-radius: 8px; min-width: 70px; border: 1px solid #333; }
        .timer-block span { display: block; font-size: 2rem; font-weight: 900; color: var(--color-primary); }
        .timer-block p { font-size: 0.8rem; color: var(--color-text-secondary); text-transform: uppercase; }
        .social-proof { background-color: var(--color-background); padding: 30px 0; border-top: 1px solid #333; border-bottom: 1px solid #333; }
        .social-proof .container { display: flex; flex-wrap: wrap; justify-content: space-around; align-items: center; gap: 20px; }
        .proof-item { display: flex; align-items: center; gap: 10px; font-size: 1rem; font-weight: 700; color: var(--color-text-secondary); }
        .proof-item i { font-size: 1.5rem; color: var(--color-secondary); }
        .proof-item strong { color: var(--color-text-primary); }
        .proof-item .fa-star { color: var(--color-warning); }
        .featured-stores-section { padding: 40px 0; background-color: var(--color-surface); }
        .featured-stores-section h2 { font-size: 1.8rem; font-weight: 900; text-align: center; margin-bottom: 30px; }
        .stores-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; justify-items: center; }
        .store-item { text-decoration: none; color: var(--color-text-secondary); transition: transform 0.3s ease; }
        .store-item:hover { transform: scale(1.1); }
        .store-item figure { width: 100px; height: 100px; border-radius: 50%; background-color: #fff; display: flex; justify-content: center; align-items: center; margin: 0 auto 10px auto; border: 3px solid var(--color-primary); overflow: hidden; }
        .store-item img { width: 70%; height: auto; object-fit: contain; }
        .store-item p { font-size: 0.9rem; font-weight: 700; text-align: center; }
        .view-all-link-container { text-align: center; margin-top: 30px; }
        .view-all-cta { display: inline-block; padding: 12px 25px; background-color: var(--color-surface); color: var(--color-primary); border: 2px solid var(--color-primary); border-radius: 8px; font-weight: 700; text-decoration: none; transition: all 0.3s ease; }
        .view-all-cta:hover { background-color: var(--color-primary); color: var(--color-text-primary); }
        .view-all-cta i { margin-left: 8px; }
        .ad-space { width: 100%; max-width: 970px; min-height: 100px; background-color: var(--color-surface); border: 2px dashed var(--color-warning); border-radius: 8px; display: flex; justify-content: center; align-items: center; flex-direction: column; margin: 30px auto; padding: 10px; }
        .ad-space h4 { font-size: 1.1rem; color: var(--color-text-secondary); margin-bottom: 5px; text-align: center; }
        .ad-space p { font-size: 0.8rem; color: var(--color-warning); text-align: center; }
        .campaigns-section { padding: 40px 0; background-color: var(--color-background); }
        .campaigns-grid { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 20px; scrollbar-color: var(--color-primary) var(--color-surface); scrollbar-width: thin; }
        .campaigns-grid::-webkit-scrollbar { height: 8px; }
        .campaigns-grid::-webkit-scrollbar-track { background: var(--color-surface); border-radius: 4px; }
        .campaigns-grid::-webkit-scrollbar-thumb { background-color: var(--color-primary); border-radius: 4px; }
        .campaign-card { flex: 0 0 280px; background-color: var(--color-surface); border-radius: 12px; overflow: hidden; text-decoration: none; color: var(--color-text-primary); border: 1px solid #333; transition: transform 0.3s ease; }
        .campaign-card:hover { transform: scale(1.03); }
        .campaign-card img { width: 100%; height: 150px; object-fit: cover; border-bottom: 2px solid var(--color-primary); }
        .campaign-card-content { padding: 15px; }
        .campaign-card-content h4 { font-size: 1.1rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .campaign-card-content p { font-size: 0.9rem; color: var(--color-text-secondary); }
        .offers-section, .products-section { padding: 40px 0; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-spinner { width: 60px; height: 60px; border: 8px solid var(--color-surface); border-top-color: var(--color-primary); border-radius: 50%; margin: 40px auto; animation: spin 1s linear infinite; display: block; }
        .api-error { display: none; background-color: var(--color-surface); border: 2px solid var(--color-warning); border-radius: 8px; padding: 30px; text-align: center; margin: 20px 0; }
        .api-error h3 { color: var(--color-warning); font-size: 1.5rem; margin-bottom: 10px; }
        .api-error p { color: var(--color-text-secondary); font-size: 1rem; }
        .coupons-grid, .products-grid { display: grid; grid-template-columns: 1fr; gap: 25px; min-height: 200px; }
        .coupon-card { background-color: var(--color-surface); border-radius: 12px; border: 1px solid #333; display: flex; flex-direction: column; padding: 20px; position: relative; overflow: hidden; }
        .card-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .card-logo { width: 80px; height: 80px; border-radius: 8px; overflow: hidden; border: 1px solid #444; display: flex; justify-content: center; align-items: center; background-color: #fff; flex-shrink: 0; }
        .card-logo img { width: 80%; height: auto; object-fit: contain; }
        .card-info { flex-grow: 1; }
        .card-discount { font-size: 1.8rem; font-weight: 900; color: var(--color-primary); line-height: 1.1; margin-bottom: 5px; }
        .card-title { font-size: 1.1rem; font-weight: 700; color: var(--color-text-primary); margin-bottom: 10px; }
        .card-validity { font-size: 0.9rem; font-weight: 700; color: var(--color-warning); }
        .card-validity i { margin-right: 5px; }
        .coupon-cta { display: inline-block; width: 100%; background-color: var(--color-primary); color: var(--color-text-primary); font-size: 1.1rem; font-weight: 700; text-transform: uppercase; padding: 15px; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease; margin-top: auto; text-align: center; text-decoration: none; }
        .coupon-cta:hover { background-color: #e03070; transform: scale(1.02); }
        .coupon-cta.copied { background-color: var(--color-secondary); font-weight: 900; }
        .badge { position: absolute; top: 20px; right: -35px; min-width: 150px; text-align: center; background-color: var(--color-warning); color: #000; font-size: 0.8rem; font-weight: 900; padding: 5px 10px; transform: rotate(45deg); box-shadow: 0 4px 10px rgba(0,0,0,0.3); text-transform: uppercase; }
        .product-card { background-color: var(--color-surface); border-radius: 12px; border: 1px solid #333; display: flex; flex-direction: column; overflow: hidden; }
        .product-card .product-image { width: 100%; height: 220px; object-fit: cover; border-bottom: 1px solid #333; }
        .product-card-content { padding: 20px; display: flex; flex-direction: column; flex-grow: 1; }
        .product-card-content h4 { font-size: 1.1rem; font-weight: 700; margin-bottom: 10px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; min-height: 2.4em; }
        .product-store { font-size: 0.9rem; color: var(--color-text-secondary); margin-bottom: 15px; }
        .product-price { font-size: 2rem; font-weight: 900; color: var(--color-secondary); margin-bottom: 20px; }
        .product-cta { display: inline-block; width: 100%; background-color: var(--color-secondary); color: var(--color-text-primary); font-size: 1.1rem; font-weight: 700; text-transform: uppercase; padding: 15px; border: none; border-radius: 8px; cursor: pointer; text-align: center; text-decoration: none; margin-top: auto; transition: background-color 0.3s ease; }
        .product-cta:hover { background-color: #00a08c; }
        .ad-card { background-color: var(--color-surface); border: 2px dashed var(--color-primary); border-radius: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; min-height: 400px; color: var(--color-text-secondary); text-align: center; }
        .ad-card h4 { font-size: 1.2rem; color: var(--color-text-primary); margin-bottom: 10px; }
        .ad-card p { font-size: 0.9rem; color: var(--color-warning); }
        .ad-card .ad-placeholder-box { width: 300px; height: 250px; background: #333; display: flex; justify-content: center; align-items: center; color: #555; font-weight: 900; font-size: 1.5rem; border-radius: 8px; margin-top: 15px; }
        .footer { background-color: var(--color-surface); text-align: center; padding: 30px 0; margin-top: 40px; border-top: 1px solid #333; }
        .footer p { color: var(--color-text-secondary); font-size: 0.9rem; }
        .footer p:first-child { font-weight: 700; color: var(--color-text-primary); margin-bottom: 5px; }
        #cookie-consent-banner { position: fixed; bottom: 0; left: 0; width: 100%; background-color: var(--color-surface); border-top: 2px solid var(--color-primary); padding: 20px; z-index: 1000; display: flex; flex-direction: column; text-align: center; box-shadow: 0 -4px 15px rgba(0,0,0,0.3); transform: translateY(100%); transition: transform 0.5s ease-in-out; }
        #cookie-consent-banner.show { transform: translateY(0); }
        #cookie-consent-banner p { font-size: 0.9rem; color: var(--color-text-secondary); margin: 0 0 15px 0; }
        #cookie-consent-banner p a { color: var(--color-primary); font-weight: 700; text-decoration: underline; }
        #accept-cookies { background-color: var(--color-primary); color: var(--color-text-primary); border: none; padding: 12px 25px; border-radius: 8px; font-weight: 700; font-size: 1rem; cursor: pointer; width: 100%; transition: background-color 0.3s ease; }
        #accept-cookies:hover { background-color: #e03070; }
        @media (min-width: 768px) {
            .hero h1 { font-size: 3.5rem; }
            .coupons-grid, .products-grid { grid-template-columns: 1fr 1fr; }
            .stores-grid { grid-template-columns: repeat(3, 1fr); }
            #cookie-consent-banner { flex-direction: row; align-items: center; text-align: left; }
            #cookie-consent-banner p { margin: 0 20px 0 0; flex-grow: 1; }
            #accept-cookies { width: auto; flex-shrink: 0; }
        }
        @media (min-width: 1024px) {
            .coupons-grid, .products-grid { grid-template-columns: 1fr 1fr 1fr; }
            .stores-grid { grid-template-columns: repeat(6, 1fr); }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="container">
            <a href="index.html" class="logo" title="MegaCupons - P√°gina Inicial"><i class="fa-solid fa-rocket"></i> MegaCupons</a>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="container">
                <h1>Sua Economia Come√ßa <span style="color: var(--color-primary);">AGORA!</span> <i class="fa-solid fa-bolt-lightning"></i></h1>
                <p class="hero-subtitle">Cupons, Ofertas e Campanhas reais, verificados e atualizados.</p>
                <div class="countdown">
                    <h3 class="countdown-title">‚ö° Ofertas Rel√¢mpago terminam em:</h3>
                    <div class="countdown-timer" id="timer">
                        <div class="timer-block"><span id="hours">23</span><p>Horas</p></div>
                        <div class="timer-block"><span id="minutes">59</span><p>Minutos</p></div>
                        <div class="timer-block"><span id="seconds">40</span><p>Segundos</p></div>
                    </div>
                </div>
            </div>
        </section>

        <section class="social-proof">
            <div class="container">
                <div class="proof-item">
                    <i class="fa-solid fa-users"></i>
                    <p><strong>+15.480</strong> pessoas usaram hoje</p>
                </div>
                <div class="proof-item">
                    <i class="fa-solid fa-tags"></i>
                    <p><strong><span id="dynamic-coupon-count">...</span></strong> cupons ativos agora</p>
                </div>
                <div class="proof-item">
                    <i class="fa-solid fa-shield-halved"></i>
                    <p>Cupons <strong>100% Verificados</strong></p>
                </div>
            </div>
        </section>

        <div class="container">
            <div class="ad-space" id="ad-slot-top">
                <div>
                    <h4>Espa√ßo Publicit√°rio (Leaderboard)</h4>
                    <p>(Cole seu c√≥digo de an√∫ncio 728x90 ou 970x90 aqui)</p>
                </div>
            </div>
        </div>

        <section class="featured-stores-section">
            <div class="container">
                <h2><i class="fa-solid fa-store" style="color: var(--color-secondary);"></i> Lojas em Destaque</h2>
                <!-- Esta se√ß√£o de lojas ainda √© est√°tica. -->
                <div class="stores-grid">
                    <a href="#link-loja-1" target="_blank" class="store-item" title="Cupons Magazine Luiza">
                        <figure><img src="https://logo.clearbit.com/magazineluiza.com.br" alt="Logo Magazine Luiza" onerror="this.onerror=null;this.src='https://placehold.co/80x80/FFFFFF/E60014?text=Magalu&font=inter';"></figure>
                        <p>Magazine Luiza</p>
                    </a>
                    <a href="#link-loja-2" target="_blank" class="store-item" title="Cupons Amazon">
                        <figure><img src="https://logo.clearbit.com/amazon.com.br" alt="Logo Amazon" onerror="this.onerror=null;this.src='https://placehold.co/80x80/FFFFFF/000000?text=Amazon&font=inter';"></figure>
                        <p>Amazon</p>
                    </a>
                    <a href="#link-loja-3" target="_blank" class="store-item" title="Cupons Americanas">
                        <figure><img src="https://logo.clearbit.com/americanas.com.br" alt="Logo Americanas" onerror="this.onerror=null;this.src='https://placehold.co/80x80/FFFFFF/B20000?text=Americ.&font=inter';"></figure>
                        <p>Americanas</p>
                    </a>
                    <a href="#link-loja-4" target="_blank" class="store-item" title="Cupons Netshoes">
                        <figure><img src="https://logo.clearbit.com/netshoes.com.br" alt="Logo Netshoes" onerror="this.onerror=null;this.src='https://placehold.co/80x80/FFFFFF/00A3E0?text=Netshoes&font=inter';"></figure>
                        <p>Netshoes</p>
                    </a>
                    <a href="#link-loja-5" target="_blank" class="store-item" title="Cupons Casas Bahia">
                        <figure><img src="https://logo.clearbit.com/casasbahia.com.br" alt="Logo Casas Bahia" onerror="this.onerror=null;this.src='https://placehold.co/80x80/FFFFFF/00439C?text=Casas+Bahia&font=inter';"></figure>
                        <p>Casas Bahia</p>
                    </a>
                    <a href="#link-loja-6" target="_blank" class="store-item" title="Cupons iFood">
                        <figure><img src="https://logo.clearbit.com/ifood.com.br" alt="Logo iFood" onerror="this.onerror=null;this.src='https://placehold.co/80x80/FFFFFF/EA1D2C?text=iFood&font=inter';"></figure>
                        <p>iFood</p>
                    </a>
                </div>
                
                <div class="view-all-link-container">
                    <a href="stores.html" class="view-all-cta">
                        Ver Todas as Lojas Parceiras <i class="fa-solid fa-arrow-right"></i>
                    </a>
                </div>

            </div>
        </section>

        
<section class="campaigns-section">
            <div class="container">
                <h2 class="section-title"><i class="fa-solid fa-bullhorn" style="color: var(--color-warning);"></i> Campanhas Ativas</h2>
                <div class="loading-spinner" id="campaigns-loading"></div>
                <div class="api-error" id="campaigns-error"></div>
                <div class="campaigns-grid" id="campaigns-grid">
                    <!-- Cards de Campanha via JS (Vercel API) -->
                </div>
            </div>
        </section>

        

<section class="offers-section">
            <div class="container">
                <h2 class="section-title"><i class="fa-solid fa-fire" style="color: var(--color-primary);"></i> Top Cupons Verificados</h2>
                <div class="loading-spinner" id="coupons-loading"></div>
                <div class="api-error" id="coupons-error"></div>
                <div class="coupons-grid" id="coupons-grid">
                    <!-- Cards de Cupom via JS (Vercel API) -->
                </div>
            </div>
        </section>

        
<section class="products-section">
            <div class="container">
                <h2 class="section-title"><i class="fa-solid fa-bag-shopping" style="color: var(--color-secondary);"></i> Ofertas de Produtos</h2>
                <div class="loading-spinner" id="products-loading"></div>
                <div class="api-error" id="products-error"></div>
                <div class="products-grid" id="products-grid">
                    <!-- Cards de Ofertas/Deals via JS (Vercel API) -->
                </div>
            </div>
        </section>

        

<div class="container">
            <div class="ad-space" id="ad-slot-bottom">
                 <div>
                    <h4>Espa√ßo Publicit√°rio (Leaderboard)</h4>
                    <p>(Cole seu c√≥digo de an√∫ncio 728x90 ou 970x90 aqui)</p>
                </div>
            </div>
        </div>

    </main>

    <footer class="footer">
        <div class="container">
            <p>MegaCupons &copy; <span id="current-year"></span> - Todos os direitos reservados.</p>
            <p>Economia real, 100% gr√°tis e verificada para voc√™.</p>
        </div>
    </footer>

    
<div id="cookie-consent-banner">
    <p>Utilizamos cookies para otimizar sua experi√™ncia de navega√ß√£o. Ao continuar, voc√™ concorda com nosso uso de cookies.</p>
    <button id="accept-cookies">Aceitar e Fechar</button>
</div>

    
<script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- ETAPA 1: CONFIGURA√á√ÉO (VERCEL) ---
        
        // As chaves de API foram movidas para as fun√ß√µes serverless na pasta /api/
        // O frontend agora chama a sua pr√≥pria API (proxy).
        const API_BASE_URL = "/api";
        
        // --- FIM DA CONFIGURA√á√ÉO ---


        // --- Elementos do DOM ---
        const couponsGrid = document.getElementById('coupons-grid');
        const couponsLoading = document.getElementById('coupons-loading');
        const couponsError = document.getElementById('coupons-error');
        
        const campaignsGrid = document.getElementById('campaigns-grid');
        const campaignsLoading = document.getElementById('campaigns-loading');
        const campaignsError = document.getElementById('campaigns-error');
        
        const productsGrid = document.getElementById('products-grid');
        const productsLoading = document.getElementById('products-loading');
        const productsError = document.getElementById('products-error');
        
        const countEl = document.getElementById('dynamic-coupon-count');
        const yearEl = document.getElementById('current-year');
        const cookieBanner = document.getElementById('cookie-consent-banner');
        const acceptButton = document.getElementById('accept-cookies');


        /**
         * Fun√ß√£o Principal: Carrega todos os dados da API (via proxy da Vercel)
         */
        async function loadAllData() {
            // Carrega tudo
            loadCampaigns();
            loadCoupons();
            loadProducts(); // Carrega "Deals" (ofertas sem c√≥digo)
        }

        /**
         * Carrega Cupons (via /api/cupons)
         */
        async function loadCoupons() {
            if (couponsLoading) couponsLoading.style.display = 'block';
            if (couponsError) couponsError.style.display = 'none';

            // Chama o proxy local, que por sua vez chama a AWIN
            const apiUrl = `${API_BASE_URL}/cupons`;

            try {
                // N√£o s√£o necess√°rios headers de autoriza√ß√£o aqui
                const response = await fetch(apiUrl); 
                if (!response.ok) throw new Error(`Status: ${response.status}`);
                
                const data = await response.json(); 
                
                if (data && data.length > 0) {
                    generateCouponCards(data); 
                    if (countEl) {
                        countEl.textContent = data.length; 
                    }
                } else {
                    showApiError('coupons', false, "Nenhum cupom encontrado hoje.");
                }
            } catch (error) {
                console.error("Falha ao buscar cupons:", error);
                showApiError('coupons', false, "Erro ao carregar cupons. Tente novamente.");
            } finally {
                if (couponsLoading) couponsLoading.style.display = 'none';
            }
        }

        /**
         * Carrega Campanhas (via /api/campanhas)
         */
        async function loadCampaigns() {
            if (campaignsLoading) campaignsLoading.style.display = 'block';
            if (campaignsError) campaignsError.style.display = 'none';

            // Chama o proxy local
            const apiUrl = `${API_BASE_URL}/campanhas`;

            try {
                const response = await fetch(apiUrl); 
                if (!response.ok) throw new Error(`Status: ${response.status}`);
                
                const data = await response.json();
                if (data.promotions && data.promotions.length > 0) {
                    generateCampaignCards(data.promotions);
                } else {
                    showApiError('campaigns', false, "Nenhuma campanha ativa no momento.");
                }
            } catch (error) {
                console.error("Falha ao buscar campanhas:", error);
                showApiError('campaigns', false, "Erro ao carregar campanhas.");
            } finally {
                if (campaignsLoading) campaignsLoading.style.display = 'none';
            }
        }

         /**
         * Carrega Ofertas/Deals (via /api/produtos)
         */
        async function loadProducts() {
            if (productsLoading) productsLoading.style.display = 'block';
            if (productsError) productsError.style.display = 'none';

            // Chama o proxy local
            const apiUrl = `${API_BASE_URL}/produtos`;

            try {
                const response = await fetch(apiUrl); 
                if (!response.ok) throw new Error(`Status: ${response.status}`);
                
                const data = await response.json();
                
                if (data && data.length > 0) {
                    generateProductCards(data); // Reutiliza a estrutura de produto para exibir deals
                } else {
                    showApiError('products', false, "Nenhum produto em oferta encontrado.");
                }
            } catch (error) {
                console.error("Falha ao buscar produtos/deals:", error);
                showApiError('products', false, "Erro ao carregar ofertas de produtos.");
            } finally {
                if (productsLoading) productsLoading.style.display = 'none';
            }
        }


        /**
         * Gera os cards de CUPOM (Dados da AWIN)
         */
        function generateCouponCards(vouchers) {
            if (!couponsGrid) return;
            couponsGrid.innerHTML = ''; 

            vouchers.forEach((voucher, index) => {
                const storeName = voucher.advertiserName;
                const logo = voucher.advertiserLogoUrl;
                const logoPlaceholder = `https://placehold.co/80x80/FFFFFF/000000?text=${storeName.split(' ')[0]}&font=inter`;
                const affiliateLink = voucher.url; 

                const cardHTML = `
                    <article class="coupon-card hover-lift">
                        ${voucher.exclusive ? '<div class="badge">Exclusivo</div>' : ''}
                        <div class="card-header">
                            <figure class="card-logo">
                                <img src="${logo}" alt="Logo ${storeName}" 
                                     onerror="this.onerror=null; this.src='${logoPlaceholder}';">
                            </figure>
                            <div class="card-info">
                                <div class="card-discount">${voucher.title}</div>
                                <h3 class="card-title">${voucher.description}</h3>
                                <p class="card-validity">
                                    <i class="fa-solid fa-clock"></i> Expira em: ${new Date(voucher.endDate).toLocaleString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' })}
                                </p>
                            </div>
                        </div>
                        <a href="${affiliateLink}" target="_blank" class="coupon-cta" 
                           data-code="${voucher.code || 'NOCODE'}">
                            ${voucher.code ? 'Revelar Cupom' : 'Ir para Oferta'}
                        </a>
                    </article>
                `;
                couponsGrid.innerHTML += cardHTML;

                if ((index + 1) % 4 === 0) {
                    couponsGrid.innerHTML += getAdCardHTML('coupon');
                }
            });
        }

        /**
         * Gera os cards de CAMPANHA (Dados da AWIN)
         */
        function generateCampaignCards(campaigns) {
            if (!campaignsGrid) return;
            campaignsGrid.innerHTML = '';
            campaigns.forEach(campaign => {
                const affiliateLink = campaign.url;
                
                const cardHTML = `
                    <a href="${affiliateLink}" target="_blank" class="campaign-card" title="${campaign.title}">
                        <img src="${campaign.image}" alt="${campaign.title}" onerror="this.onerror=null;this.src='https://placehold.co/280x150/FF3B80/FFFFFF?text=Campanha&font=inter';">
                        <div class="campaign-card-content">
                            <h4>${campaign.title}</h4>
                            <p>${campaign.description || 'Clique e aproveite!'}</p>
                        </div>
                    </a>
                `;
                campaignsGrid.innerHTML += cardHTML;
            });
        }

         /**
         * Gera os cards de PRODUTO/DEAL (Dados da AWIN)
         */
        function generateProductCards(deals) {
            if (!productsGrid) return;
            productsGrid.innerHTML = '';
            deals.forEach((deal, index) => {
                const affiliateLink = deal.url;
                const logo = deal.advertiserLogoUrl;
                const storeName = deal.advertiserName;
                const logoPlaceholder = `https://placehold.co/300x220/FFFFFF/000000?text=${storeName.split(' ')[0]}&font=inter`;

                const cardHTML = `
                    <article class="product-card hover-lift">
                        <!-- Usando o logo da loja no espa√ßo da imagem do produto -->
                        <img src="${logo}" alt="${storeName}" class="product-image" 
                             style="object-fit: contain; padding: 20px; height: 220px; background-color: #fff;" 
                             onerror="this.onerror=null;this.src='${logoPlaceholder}';">
                        
                        <div class="product-card-content">
                            <h4>${deal.title}</h4>
                            <p class="product-store">Vendido por: ${storeName}</p>
                            
                            <p class="product-price" style="display: none;">Ver Pre√ßo</p> 
                            
                            <p style="font-size: 0.9rem; color: var(--color-text-secondary); margin-bottom: 15px; flex-grow: 1;">
                                ${deal.description}
                            </p>
                            
                            <a href="${affiliateLink}" target="_blank" class="product-cta">
                                Ver Oferta <i class="fa-solid fa-arrow-right"></i>
                            </a>
                        </div>
                    </article>
                `;
                productsGrid.innerHTML += cardHTML;

                if ((index + 1) % 4 === 0) {
                    productsGrid.innerHTML += getAdCardHTML('product');
                }
            });
        }

        /**
         * Retorna HTML do card de an√∫ncio (In-feed)
         */
        function getAdCardHTML(type) {
            return `
                <article class="ad-card" id="ad-infeed-${type}">
                    <h4>Espa√ßo Publicit√°rio</h4>
                    <div class="ad-placeholder-box">300 x 250</div>
                    <p>(Google AdSense ou Afiliado Direto)</p>
                </article>
            `;
        }

        /**
         * Exibe a mensagem de erro da API
         */
        function showApiError(section = 'coupons', isConfigError = false, customMessage = "") {
            // A verifica√ß√£o 'isConfigError' foi removida, pois agora √© tratada no backend (proxy)
            
            let errorElement;
            if (section === 'coupons') errorElement = couponsError;
            if (section === 'campaigns') errorElement = campaignsError;
            if (section === 'products') errorElement = productsError;
            
            if (!errorElement) return;
            errorElement.style.display = 'block';
            
            if (customMessage) {
                 errorElement.innerHTML = `<h3><i class="fa-solid fa-face-sad-tear"></i> ${customMessage}</h3>`;
            } else {
                errorElement.innerHTML = `<h3><i class="fa-solid fa-triangle-exclamation"></i> Ofertas indispon√≠veis.</h3>
                                          <p>A conex√£o com a central de ofertas falhou. Isso pode ser um erro na Vercel ou na API da AWIN.</p>`;
            }
        }


        /**
         * FUNCIONALIDADE (Clique em Cupom): Copiar + Redirecionar
         */
        function setupCouponClickListeners() {
            if (!couponsGrid) return; 

            couponsGrid.addEventListener('click', (e) => {
                const ctaButton = e.target.closest('.coupon-cta');
                if (!ctaButton) return;
                
                if (ctaButton.classList.contains('copied')) return; 
                
                const couponCode = ctaButton.dataset.code;
                const originalText = ctaButton.textContent;

                if (couponCode === "NOCODE") {
                    ctaButton.textContent = '‚úÖ OFERTA ATIVADA';
                    ctaButton.classList.add('copied');
                    return; 
                }
                
                const tempTextarea = document.createElement('textarea');
                tempTextarea.value = couponCode;
                tempTextarea.style.position = 'absolute';
                tempTextarea.style.left = '-9999px';
                document.body.appendChild(tempTextarea);
                tempTextarea.select();
                
                try {
                    document.execCommand('copy');
                    ctaButton.textContent = '‚úÖ COPIADO!';
                    ctaButton.classList.add('copied');
                    setTimeout(() => {
                        ctaButton.textContent = `C√ìDIGO: ${couponCode}`;
                    }, 2000);
                } catch (err) {
                    console.error('Falha ao copiar o cupom: ', err);
                    ctaButton.textContent = 'Erro ao Copiar';
                     setTimeout(() => { ctaButton.textContent = originalText; }, 2000);
                }
                document.body.removeChild(tempTextarea);
            });
        }

        /**
         * FUNCIONALIDADE (Contador Regressivo)
         */
        function startCountdown() {
            const hoursEl = document.getElementById('hours');
            const minutesEl = document.getElementById('minutes');
            const secondsEl = document.getElementById('seconds');

            if (!hoursEl || !minutesEl || !secondsEl) return;

            let endTime = localStorage.getItem('countdownEndTime');
            
            if (!endTime || new Date().getTime() > endTime) {
                // Reinicia o contador para 24h a partir de agora
                endTime = new Date().getTime() + (24 * 60 * 60 * 1000);
                localStorage.setItem('countdownEndTime', endTime);
            }

            function updateTimer() {
                const now = new Date().getTime();
                const distance = endTime - now;

                if (distance < 0) {
                    localStorage.removeItem('countdownEndTime');
                    startCountdown(); // Reinicia o ciclo
                    return;
                }

                const hours = String(Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))).padStart(2, '0');
                const minutes = String(Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))).padStart(2, '0');
                const seconds = String(Math.floor((distance % (1000 * 60)) / 1000)).padStart(2, '0');

                hoursEl.textContent = hours;
                minutesEl.textContent = minutes;
                secondsEl.textContent = seconds;
            }
            
            updateTimer();
            setInterval(updateTimer, 1000);
        }

        /**
         * FUNCIONALIDADE (Ano Autom√°tico no Footer)
         */
        function updateFooterYear() {
            if (yearEl) {
                yearEl.textContent = new Date().getFullYear();
            }
        }

        /**
         * FUNCIONALIDADE (Banner de Cookies)
         */
        function checkCookieConsent() {
            if (!cookieBanner || !acceptButton) return;

            if (localStorage.getItem('cookiesAccepted') === 'true') {
                cookieBanner.style.display = 'none';
            } else {
                setTimeout(() => {
                    cookieBanner.classList.add('show');
                }, 500); 
            }

            acceptButton.addEventListener('click', () => {
                localStorage.setItem('cookiesAccepted', 'true');
                cookieBanner.classList.remove('show');
                
                setTimeout(() => {
                    cookieBanner.style.display = 'none';
                }, 500);
            });
        }


        // --- INICIALIZA√á√ÉO DO SITE ---
        updateFooterYear();
        startCountdown();
        setupCouponClickListeners();
        loadAllData(); // Carrega a API (via Proxy Vercel)
        checkCookieConsent(); // Verifica o status dos cookies

    });
</script>

</body>
</html>